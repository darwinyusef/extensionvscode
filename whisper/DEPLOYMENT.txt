Deployment Guide - Whisper Microservice

Structure:
  3 independent docker-compose files:
  1. docker-compose.yml       - Whisper (core)
  2. n8n/docker-compose.yml   - n8n workflow
  3. caddy/docker-compose.yml - Reverse proxy

Quick Start:

Development (Local):
  1. Start Whisper only:
     start.bat (Windows) or make up (Linux)

  2. Access:
     http://localhost:8001/docs

Production (Full Stack):
  1. Configure .env:
     cp .env.example .env
     Edit N8N_USER, N8N_PASSWORD

  2. Start all services:
     start-all.bat (Windows) or make all (Linux)

  3. Configure DNS:
     n8n.darwinyusef.com → Server IP
     whisper.darwinyusef.com → Server IP

  4. Access:
     https://n8n.darwinyusef.com
     https://whisper.darwinyusef.com

Environment Variables:
  MODEL_SIZE=tiny       # Whisper model size
  NATS_URL=nats://nats:4222
  GRPC_HOST=whisper_grpc
  GRPC_PORT=50051
  N8N_USER=admin
  N8N_PASSWORD=secure_password
  N8N_HOST=n8n.darwinyusef.com
  WEBHOOK_URL=https://n8n.darwinyusef.com/

Pre-requisites:
  - Docker + Docker Compose
  - 4GB+ RAM
  - ffmpeg (included in containers)

Ports:
  8001 - API Gateway (external)
  50051 - gRPC Service
  4222 - NATS Client
  8222 - NATS Monitoring
  5678 - n8n (internal)
  80/443 - Caddy (HTTP/HTTPS)

Health Checks:
  curl http://localhost:8001/health
  curl http://localhost:8222/healthz

Starting Individual Services:

Whisper only:
  docker-compose up -d

n8n only:
  cd n8n && docker-compose up -d

Caddy only:
  cd caddy && docker-compose up -d

All services:
  make all
  # or
  docker network create whisper_network
  docker-compose up -d
  cd n8n && docker-compose up -d
  cd ../caddy && docker-compose up -d

Stopping Services:

Stop all:
  make stop-all
  # or
  stop-all.bat

Stop Whisper:
  docker-compose down

Stop n8n:
  cd n8n && docker-compose down

Stop Caddy:
  cd caddy && docker-compose down

Logs:

View Whisper logs:
  docker-compose logs -f

View n8n logs:
  cd n8n && docker-compose logs -f

View Caddy logs:
  cd caddy && docker-compose logs -f

Integration with Existing Project:

Option 1 - Use as external services:
  docker network connect your_network whisper_api
  docker network connect your_network whisper_grpc
  Access via: http://whisper_api:8000

Option 2 - Merge docker-compose:
  Copy services from docker-compose.yml to your project
  Add whisper_network to networks
  Start with your existing docker-compose

Testing:
  python examples/integration_test.py
  python examples/load_test.py audio.mp3 100 10

Security Notes:
  - Change N8N_PASSWORD in production
  - n8n only listens on 127.0.0.1:5678 (not exposed)
  - Caddy handles HTTPS automatically
  - Basic auth enabled on n8n

Troubleshooting:
  make logs     # View logs
  make status   # Check status
  make restart  # Restart services
  make clean    # Clean everything

Scaling:
  Edit docker-compose.yml deploy.replicas
  Or use external orchestrator (Docker Swarm, K8s)
